# helm repo add dodas https://dodas-ts.github.io/helm_charts
# helm repo update
# helm install condor --values working.yaml dodas/htcondor
condorHost: 131.154.97.158
ccbHost: 131.154.97.158

proxyCacheHost: 131.154.97.130
proxyCachePort: 30080

htcMaster:
  image: dodasts/htcondor
  tag: v0.1.0-k8s-schedd-3

  # Condor network interface (address)
  networkInterface: "131.154.97.158"

  # Additional custom config file
  config: "FLOCK_FROM = 141.250.7.17"

htcSchedd:
  image: dodasts/htcondor
  tag: v0.1.0-k8s-schedd-3

  # Condor network interface (address)
  networkInterface: "131.154.97.143"

  # Schedd persistence configuration
  persistence:
    enabled: true
    size: 50Gi
    claimSize: 49Gi

    # local-storage for k8s, local-path for k3s
    storageClass: local-storage

    # persistence of the schedd spool directory
    mountPath: /var/lib/condor/spool/

    # mount options
    options: |
      local:
        path: "/mnt/spool"
      nodeAffinity:
        required:
          nodeSelectorTerms:
          - matchExpressions:
            - key: condor
              operator: In
              values:
              - schedd

# Condor WorkerNode configuration
htcWn:
  image: dodasts/htcondor
  tag: v0.1.0-k8s-fermi-2

  # Define you own persistent volume to mount
  persistentVolume:
    pv:
      name: "data-rclone-1"
      spec: |
        accessModes:
        - ReadWriteMany
        capacity:
          storage: 800Gi
        storageClassName: rclone
        csi:
          driver: csi-rclone
          volumeHandle: data-id
          volumeAttributes:
            remote: "s3"
            remotePath: "home"
            s3-provider: "Minio"
            s3-endpoint: "https://141.250.7.19:9000"
            s3-access-key-id: "readwrite"
            s3-secret-access-key: "p6s54RT2bqMmUZDX"
            no-check-certificate: "true"
            vfs-cache-mode: "writes"
            vfs-cache-max-size: "4G"
            buffer-size: 2G
            vfs-read-chunk-size: "512k"
            vfs-read-chunk-size-limit: "10M"
            no-modtime: "true"
    pvc:
      name: "data-rclone-1"
      mountPath: "/home/Volume_Fermi"
      spec: |
        accessModes:
        - ReadWriteMany
        resources:
          requests:
            storage: "799Gi"
        storageClassName: rclone
        volumeName: data-rclone-1
        selector:
          matchLabels:
            name: data-rclone-1

  # Resource limits and requests
  cpu:
    request: 0.8
    limit: 1.5
  ram:
    request: 1024Mi
    limit: 2048Mi

  # Condor slot type
  slotType: cpus=1, mem=2000


# Token Translation service cache configuration
ttsCache:
  image: dodasts/tts-cache
  tag: v0.1.3-k8s-12

  # IAM credential for token translation
  iamToken: eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiIxZTcwNzRlNS05NmZlLTQzZTgtODgxZC00ZDU3MmMxMjg5MzEiLCJpc3MiOiJodHRwczpcL1wvZG9kYXMtaWFtLmNsb3VkLmNuYWYuaW5mbi5pdFwvIiwiZXhwIjoxNTkyOTEwNjE3LCJpYXQiOjE1OTI5MDcwMTcsImp0aSI6IjBlOTE0OGQzLWEwODAtNDc1My05NTQ3LTcwYTZlYzFjZGY2NiIsImNsaWVudF9pZCI6ImM2YmM2OGZhLTZjMmItNGE0OC05MDAzLTFkMWYxOWRjMDcxNSJ9.UgD_sdJiuWX6CLEb5mz-l_eSUbrLiXuO1oMGQJpf6AJ6WOB0CCU0iqxQOZBBC90R2uNiJ_RMG5VUP4ruNoym1G2BIKkzWkwbU_Xn0Si1_KhwEGo8SU55zadKRaShxXxL1VcLZE4u_vqDYVUQYtrHISlwA6j792TyQR3HlNfA97k
  iamClientId: 99f7152a-0550-4be6-8c55-8f27dcbe67e0
  iamClientSecret: AIEx7S3vAiIKhinEPndgnEw61GHxMC0k-_4wiVXpLOhLokr97-wNK5PEgMZOpqfO6UkKVARyBb2lQ8i4Qdv_38o

  # TTS endpoint configuration
  proxyAudience: "https://dodas-tts.cloud.cnaf.infn.it"
  proxyTTS: "https://dodas-tts.cloud.cnaf.infn.it"
  proxyIAMEndpoint: "https://dodas-iam.cloud.cnaf.infn.it/"
  proxyCredentialEndpoint: "https://dodas-tts.cloud.cnaf.infn.it/api/v2/iam/credential"


# CVMFS mount on slave: configuration
cvmfs:
  enabled: true
  image: dodasts/cvmfs
  tag: k8s-dev
  pullPolicy: IfNotPresent
  replicas: 1

  # List of repos to be mounted
  repoList: fermi.local.repo

  privKey:
    - name: fermi
      path: keys
      filename: fermi.local.repo.pub
      content: |
        -----BEGIN PUBLIC KEY-----
        MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5Rezgpvuhl0lyEMFTuKm
        +J2D5KwjzgNLMEMG6dumKb7Zjohy8dxvhHqqH9USQrF570ug+i5pLHcZB66Z0bBC
        Ni4IyeTZyEhGo/TGV2XcJZOFX8iR9L6XcbxPOZCNtnyh+UiC6vuwqGYDuh+cLc35
        TQaqw+zrdmy5SlJNfIh4j4XAt4W9v+BUFNVAoCclCnpw2MiQjKIo+zkHiOaXecPG
        Nqg+Pmc1jVkjIsarAMtelPG9AZTftRmMpPz71DiqmVylVvBuAwyrOvVtxHUayRZ8
        VEWSOamqQ87t5rdo50X/5tyH8RDQ/s+jbRwghQN/4MYIrslakCSkwZbbKN4xPS5q
        0QIDAQAB
        -----END PUBLIC KEY-----

  defaultLocalConfig:
  - file: fermi.local.repo.conf
    content: |
      CVMFS_SERVER_URL=http://193.204.89.114/cvmfs/fermi.local.repo
      CVMFS_PUBLIC_KEY=/etc/cvmfs/keys/fermi.local.repo.pub
      CVMFS_HTTP_PROXY=DIRECT